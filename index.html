<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Random TV Episode Picker</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 font-sans">
  <div class="min-h-screen flex flex-col items-center justify-center">
    <div class="w-full bg-gradient-to-r from-blue-600 to-purple-600 py-8 px-4 text-center text-white">
      <h1 class="text-3xl font-bold">üé¨ Discover a Random Episode</h1>
      <p class="mt-2 text-sm">Pick a show, find a surprise episode, and start streaming instantly!</p>
    </div>

    <div class="max-w-4xl w-full bg-white rounded-2xl shadow-lg p-6 mt-6 mx-4">
      <div class="grid md:grid-cols-3 gap-4 mb-6">
        <div>
          <label for="platform" class="block text-sm font-medium text-gray-700 mb-1">Filter by OTT</label>
          <select id="platform" class="w-full px-3 py-2 border border-gray-300 rounded-md">
            <option value="">All</option>
            <option value="Netflix">Netflix</option>
            <option value="Amazon Prime">Amazon Prime</option>
            <option value="Disney+ Hotstar">Disney+ Hotstar</option>
            <option value="Hulu">Hulu</option>
          </select>
        </div>
        <div>
          <label for="series" class="block text-sm font-medium text-gray-700 mb-1">Filter by Series</label>
          <select id="series" class="w-full px-3 py-2 border border-gray-300 rounded-md">
            <option value="">All</option>
          </select>
        </div>
        <div class="flex items-end">
          <button onclick="pickEpisode()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md">üîÅ Refresh</button>
        </div>
      </div>

      <div id="result"></div>
    </div>
  </div>

  <script>
    const data = [
      {
        title: "Breaking Bad",
        description: "A chemistry teacher turned meth producer.",
        poster: "https://upload.wikimedia.org/wikipedia/en/6/61/Breaking_Bad_title_card.png",
        cover: "https://images.unsplash.com/photo-1609840116957-f589fa3ed3b9?fit=crop&w=1200&q=80",
        platforms: ["Netflix"],
        episodes: [
          {
            season: 1,
            episode: 1,
            title: "Pilot",
            description: "Walter White's life changes forever.",
            links: {
              US: "https://www.netflix.com/title/70143836",
              IN: "https://www.netflix.com/in/title/70143836"
            }
          }
        ]
      },
      {
        title: "The Office",
        description: "A mockumentary on a group of typical office workers.",
        poster: "https://upload.wikimedia.org/wikipedia/en/d/dc/TheOfficeUSSeason1Cover.jpg",
        cover: "https://images.unsplash.com/photo-1506377247377-2a5b3b417ebb?fit=crop&w=1200&q=80",
        platforms: ["Amazon Prime"],
        episodes: [
          {
            season: 2,
            episode: 3,
            title: "Office Olympics",
            description: "Dwight and Michael play games.",
            links: {
              US: "https://www.amazon.com/dp/B000U0Z2LM",
              IN: "https://www.primevideo.com/detail/0U8EGW9QW8"
            }
          }
        ]
      }
      // Add more entries similarly with poster and cover URLs
    ];

    let countryCode = "US";

    fetch("https://ipapi.co/json")
      .then(res => res.json())
      .then(location => {
        countryCode = location.country_code || "US";
      })
      .catch(() => {});

    function populateSeriesOptions() {
      const seriesSelect = document.getElementById("series");
      const titles = [...new Set(data.map(item => item.title))];
      titles.forEach(title => {
        const opt = document.createElement("option");
        opt.value = title;
        opt.textContent = title;
        seriesSelect.appendChild(opt);
      });
    }

    function pickEpisode() {
      const platformFilter = document.getElementById("platform").value;
      const seriesFilter = document.getElementById("series").value;

      let filtered = data;
      if (platformFilter) {
        filtered = filtered.filter(show => show.platforms.includes(platformFilter));
      }
      if (seriesFilter) {
        filtered = filtered.filter(show => show.title === seriesFilter);
      }

      if (!filtered.length) {
        document.getElementById("result").innerHTML = "<p class='text-red-600'>No matching shows found.</p>";
        return;
      }

      const show = filtered[Math.floor(Math.random() * filtered.length)];
      const episode = show.episodes[Math.floor(Math.random() * show.episodes.length)];

      const link = episode.links[countryCode] || Object.values(episode.links)[0];

      document.getElementById("result").innerHTML = `
        <div class="overflow-hidden rounded-xl shadow-lg border border-gray-200">
          <img src="${show.cover}" class="w-full h-48 object-cover" alt="${show.title} cover" />
          <div class="p-4">
            <div class="flex items-start gap-4">
              <img src="${show.poster}" class="w-24 h-36 object-cover rounded-md" alt="${show.title} poster" />
              <div>
                <h3 class="text-2xl font-bold">${show.title}</h3>
                <p class="mt-1 text-sm text-gray-600">${show.description}</p>
                <p class="mt-2 text-sm text-gray-700 font-medium">S${episode.season}E${episode.episode}: ${episode.title}</p>
                <p class="text-sm text-gray-600">${episode.description}</p>
                <p class="mt-1 text-sm text-gray-500">Available on: ${show.platforms.join(", ")}</p>
                <a href="${link}" target="_blank" class="inline-block mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md">‚ñ∂Ô∏è Play Now</a>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    window.onload = () => {
      populateSeriesOptions();
      pickEpisode();
    };
  </script>
</body>
</html>
